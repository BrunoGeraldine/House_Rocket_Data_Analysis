
# Handling .Json file whit Multi_thread process
import time
from multiprocessing import Pool

# creating new column 'query'
data['query'] = data[['lat', 'long']].apply(lambda x: str(x['lat']) + ',' + str(x['long']), axis=1)

def get_data( x ):
    index, row = x
    time.sleep( 1 )
    
    # call the api
    response = geolocator.reverse(row['query'])
    
    try:
        place_id = response.raw['place_id']
        osm_type = response.raw['osm-_type']
        country = response.raw['address']['country'] # this informar are in other subpack
        country_code = response.raw['address']['country_code'] # necessary declare the subfolder
        
        return place_id, osm_type, country, country_code
        
 # Creating dataframe only for multi_thread process
df1 = data[['id', 'query']].head()

p = Pool(3) # Select only 3 cors at the machine

start = time.process_time()
df1[['place_id','osm_type', 'country', 'country_code']] = p.map( get_data, df1.iterrows() )
